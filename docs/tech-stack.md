# Технологический стек

## Обоснование выбора технологий

### Язык программирования: Go

#### Go 1.21+
**Преимущества:**
- Высокая производительность (компилируемый язык)
- Простота развертывания (один исполняемый файл без зависимостей)
- Встроенная поддержка многопоточности (goroutines)
- Быстрая компиляция
- Отличная работа с CSV и Excel через библиотеки
- Кросс-компиляция из коробки
- Меньший размер итогового файла (30-50 MB против 100-150 MB в Python)
- Простой синтаксис и низкий порог входа

**Недостатки:**
- Меньше библиотек для работы с Excel по сравнению с Python
- Более строгая типизация требует больше кода

**Почему именно Go для этого проекта:**
- Один исполняемый файл - легкое распространение
- Отличная производительность при работе с большими Excel файлами
- Простота развертывания без установки runtime
- Кросс-компиляция для Windows/macOS/Linux

### GUI Framework: Fyne

#### Fyne v2.4+
**Преимущества:**
- Современный Material Design интерфейс
- Нативная кросс-платформенность (Windows, macOS, Linux, mobile)
- Простой и понятный API
- Встроенная поддержка тем (светлая/темная)
- Легкие исполняемые файлы
- Отличная документация и активное сообщество
- Drag & Drop из коробки
- Responsive layout
- Не требует CGO для базового функционала

**Недостатки:**
- Менее богатая библиотека виджетов чем Qt
- Относительно молодой фреймворк

**Почему именно Fyne для этого проекта:**
- Простота создания wizard-подобного интерфейса через container.AppTabs
- widget.Table для отображения предпросмотра данных
- widget.Tree и widget.Check для отображения листов с чекбоксами
- Современный внешний вид
- Минимальный размер приложения

### Обработка Excel: excelize

**excelize (github.com/xuri/excelize/v2)**
- Чистая Go библиотека (без CGO)
- Полная поддержка формата .xlsx (Office 2007+)
- Чтение и запись Excel файлов
- Работа с несколькими листами
- Получение списка всех листов в файле
- Чтение данных начиная с указанной строки
- Поддержка стилей и форматирования
- Высокая производительность
- Активная разработка и поддержка

**Альтернативы:**
- **xlsx (github.com/tealeg/xlsx)** - старая библиотека, менее активная
- **unioffice (github.com/unidoc/unioffice)** - коммерческая лицензия

**Почему excelize:**
- Самая популярная и активная Go библиотека для Excel
- Отличная документация и примеры
- Поддержка всех необходимых функций
- Регулярные обновления

## Полный список зависимостей

### Основные библиотеки
```go
require (
    fyne.io/fyne/v2 v2.4.3
    github.com/xuri/excelize/v2 v2.8.0
)
```

### Дополнительные библиотеки (автоматически подтянутся)
```go
require (
    fyne.io/systray v1.10.1-0.20231115130155-104f5ef7839e
    github.com/fredbi/uri v1.0.0
    github.com/go-text/render v0.0.0-20230619120952-35bccb6164b8
    golang.org/x/image v0.14.0
    golang.org/x/sys v0.15.0
)
```

### Утилиты разработки
```bash
# Тестирование
go test

# Покрытие кода
go test -cover ./...

# Линтер
golangci-lint run

# Форматирование
gofmt -w .
go vet ./...
```

### Сборка
```bash
# Fyne CLI для упаковки
go install fyne.io/fyne/v2/cmd/fyne@latest

# Дополнительные инструменты
go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest
```

## Альтернативные варианты стека

### Вариант 1: Рекомендуемый (Go + Fyne)
- **Язык:** Go 1.21+
- **GUI:** Fyne v2.4+
- **Excel:** excelize v2.8+
- **Сборка:** Fyne CLI
- **Размер:** ~30-50 MB
- **Подходит для:** Профессиональное кросс-платформенное приложение

### Вариант 2: Легковесный (Go + CLI)
- **Язык:** Go 1.21+
- **GUI:** Без GUI (CLI с интерактивным режимом)
- **Excel:** excelize v2.8+
- **Сборка:** go build
- **Размер:** ~10-15 MB
- **Подходит для:** Автоматизация через скрипты

### Вариант 3: Python (предыдущая концепция)
- **Язык:** Python 3.10+
- **GUI:** PyQt6 или CustomTkinter
- **Excel:** pandas + openpyxl
- **Сборка:** PyInstaller
- **Размер:** ~100-150 MB
- **Подходит для:** Быстрое прототипирование

## Рекомендации по развертыванию

### Windows
```bash
# Сборка .exe
fyne package -os windows -icon assets/icon.png

# Или кросс-компиляция из Linux/macOS
GOOS=windows GOARCH=amd64 fyne package -os windows -icon assets/icon.png
```

### macOS
```bash
# Сборка .app
fyne package -os darwin -icon assets/icon.png

# Или с кросс-компиляцией
GOOS=darwin GOARCH=amd64 fyne package -os darwin -icon assets/icon.png
```

### Linux
```bash
# Сборка исполняемого файла
fyne package -os linux -icon assets/icon.png

# Или просто
go build -o excel-merger ./cmd/excel-merger
```

### Кросс-компиляция для всех платформ
```bash
# Из макроса Makefile
make build-all

# Или вручную
GOOS=windows GOARCH=amd64 go build -o build/excel-merger-windows.exe ./cmd/excel-merger
GOOS=darwin GOARCH=amd64 go build -o build/excel-merger-macos ./cmd/excel-merger
GOOS=linux GOARCH=amd64 go build -o build/excel-merger-linux ./cmd/excel-merger
```

## Версионирование

- Go: 1.21+
- Fyne: v2.4+
- Excelize: v2.8+
- Поддержка Excel: .xlsx (2007+)
- Операционные системы: Windows 10+, macOS 11+, Linux (Ubuntu 20.04+)

## Производительность

### Оптимизации
- Использование goroutines для параллельной обработки файлов
- Streaming чтение для больших файлов (>10 MB)
- Показ прогресса операций в реальном времени через каналы
- Эффективное использование памяти в Go
- Буферизованное чтение/запись

### Рекомендуемые ограничения
- Максимальный размер одного файла: 200 MB (Go лучше работает с памятью)
- Рекомендуемое количество одновременно обрабатываемых файлов: 200+
- Количество строк для предпросмотра: 100

### Преимущества Go над Python
- **Скорость:** В 5-10 раз быстрее обработка больших файлов
- **Память:** Более эффективное использование RAM
- **Параллелизм:** Нативная поддержка goroutines
- **Размер:** Приложение в 3-4 раза меньше

## Безопасность

- Валидация загружаемых файлов (проверка расширения .xlsx)
- Обработка ошибок при чтении поврежденных файлов через defer/recover
- Проверка существования указанных листов
- Валидация номера строки заголовков (должна быть >= 1)
- Структурированное логирование (log/slog в Go 1.21+)
- Типобезопасность на уровне компилятора

## Преимущества миграции на Go + Fyne

### 1. Производительность
- ✅ Компилируемый язык - быстрое выполнение
- ✅ Эффективная работа с памятью
- ✅ Нативная многопоточность (goroutines)
- ✅ Отсутствие GIL (в отличие от Python)

### 2. Развертывание
- ✅ Один исполняемый файл без зависимостей
- ✅ Не нужен установленный runtime
- ✅ Меньший размер приложения (30-50 MB vs 100-150 MB)
- ✅ Простая кросс-компиляция

### 3. Разработка
- ✅ Строгая типизация - меньше ошибок во время выполнения
- ✅ Быстрая компиляция
- ✅ Встроенное тестирование и бенчмарки
- ✅ Простой код без "магии"

### 4. Пользовательский опыт
- ✅ Быстрый запуск приложения
- ✅ Меньшее потребление памяти
- ✅ Современный Material Design интерфейс
- ✅ Нативный вид на каждой платформе

### 5. Поддержка
- ✅ Активное сообщество Fyne
- ✅ Регулярные обновления библиотек
- ✅ Отличная документация
- ✅ Долгосрочная стабильность Go
