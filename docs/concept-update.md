# Обновление концепции проекта

## Дата: 11 ноября 2024

## Основные изменения в концепции

### До изменений
Универсальное приложение с множественными режимами объединения:
- Вертикальное, горизонтальное, по ключевым полям
- Сложная валидация соответствия структур
- Множество настроек и опций

### После изменений
Целевое приложение с шаблонным подходом:
- **Один режим**: вертикальное объединение по шаблону базового файла
- **Упрощение**: структура столбцов одинакова во всех файлах
- **Кастомизация**: настройка правил через базовый файл

## Ключевые особенности новой концепции

### 1. Принцип работы
```
Базовый файл → Настройка правил → Добавление файлов → Объединение
```

### 2. Настройка правил для каждого листа
- Выбор листов для обработки (включение/выключение)
- Номер строки с заголовками (может быть разным для разных листов)
- Предпросмотр заголовков

### 3. Объединение
- Заголовки берутся из базового файла (один раз)
- Данные склеиваются из всех файлов (включая базовый)
- Каждый лист обрабатывается отдельно

### 4. Упрощения
- Не нужна валидация соответствия структур
- Не нужны множественные режимы объединения
- Фокус на одной задаче, но с максимальной гибкостью

## Обновленные документы

### 1. project-plan.md
**Изменено:**
- Описание концепции работы
- Этапы разработки (упрощены с 6 до более реалистичных сроков)
- Структура проекта (добавлены модули для wizard-интерфейса)
- Основные функции (фокус на настройке через базовый файл)
- Пример рабочего процесса

**Ключевые добавления:**
- Пошаговый wizard-интерфейс (3 шага)
- Модуль BaseAnalyzer для анализа базового файла
- Модуль ConfigManager для работы с профилями
- Детальное описание каждого шага работы

### 2. tech-stack.md
**Изменено:**
- Обоснование выбора PyQt6 (упор на QWizard)
- Убрана зависимость от xlrd/xlwt (только .xlsx)
- Упрощен список зависимостей
- Обновлены рекомендации по производительности

**Ключевые изменения:**
- Фокус на PyQt6 QWizard для пошагового интерфейса
- QTreeWidget для отображения листов с настройками
- Только формат .xlsx (современный Excel)

### 3. architecture.md
**Изменено:**
- Полностью переработан GUI Layer (3 wizard-шага)
- Новый класс BaseAnalyzer
- Новый класс SheetConfig (dataclass)
- Упрощен ExcelMerger (только вертикальное объединение)
- Убран Validator (не нужен при одинаковой структуре)

**Ключевые добавления:**
- Детальное описание каждого шага wizard
- Паттерн Configuration для управления правилами
- Facade Pattern для упрощения интерфейса
- Обработка особых случаев (отсутствие листа в файле)

### 4. merge-algorithm.md (НОВЫЙ)
**Содержание:**
- Детальное описание алгоритма объединения
- Примеры с визуализацией данных
- Обработка особых случаев
- Оптимизация для больших файлов
- Индикация прогресса
- Валидация и проверки

### 5. user-guide.md (НОВЫЙ)
**Содержание:**
- Быстрый старт (5 шагов)
- Детальное описание функций
- Работа со строкой заголовков (с примерами)
- Работа с профилями
- Типичные сценарии использования
- Советы и рекомендации
- Устранение неполадок
- Горячие клавиши

### 6. README.md (НОВЫЙ)
**Содержание:**
- Описание проекта
- Пример использования
- Быстрый старт
- Установка и запуск
- Структура проекта
- Roadmap
- Информация для разработчиков

## Преимущества новой концепции

### ✓ Простота использования
- Понятный wizard из 3 шагов
- Визуальная настройка правил
- Предпросмотр на каждом этапе

### ✓ Гибкость
- Настройка правил для каждого листа индивидуально
- Поддержка разных строк заголовков
- Сохранение профилей для повторного использования

### ✓ Надежность
- Один четкий алгоритм работы
- Меньше кода = меньше ошибок
- Прозрачная обработка исключений

### ✓ Производительность
- Оптимизация для конкретной задачи
- Эффективное использование pandas
- Прогресс в реальном времени

## Технические детали

### Основной алгоритм
```python
1. Анализ базового файла (получение листов)
2. Настройка правил (header_row, enabled для каждого листа)
3. Для каждого листа:
   - Чтение из базового файла (с указанной строкой заголовков)
   - Чтение из остальных файлов (те же настройки)
   - pd.concat() для вертикального объединения
4. Сохранение результата (многолистовой Excel)
```

### Структура конфигурации
```python
@dataclass
class SheetConfig:
    sheet_name: str
    header_row: int      # 1-based (для пользователя)
    enabled: bool
    headers: List[str]
```

### Wizard Steps
1. **BaseFileStep** - анализ и настройка базового файла
2. **FileListStep** - добавление файлов для объединения
3. **MergeStep** - выполнение объединения и сохранение

## Следующие шаги

### Фаза 1: Прототип ядра (3-4 дня)
- [ ] Реализовать ExcelReader
- [ ] Реализовать BaseAnalyzer
- [ ] Реализовать ExcelMerger
- [ ] Unit-тесты для core модулей

### Фаза 2: GUI (4-5 дней)
- [ ] Создать QWizard с 3 страницами
- [ ] Реализовать BaseFileStep
- [ ] Реализовать FileListStep
- [ ] Реализовать MergeStep
- [ ] Интеграция с core модулями

### Фаза 3: Полировка (2-3 дня)
- [ ] Сохранение/загрузка профилей
- [ ] Обработка ошибок и валидация
- [ ] Логирование
- [ ] Integration тесты

### Фаза 4: Релиз (1-2 дня)
- [ ] Сборка для Windows/macOS
- [ ] Тестирование на разных ОС
- [ ] Финальная документация
- [ ] Создание установщиков

## Итого

**Общее время разработки:** 10-14 дней

**Размер приложения:** ~100-150 MB

**Целевая аудитория:** Пользователи, регулярно объединяющие Excel файлы с одинаковой структурой

**Основное преимущество:** Простота + гибкость через кастомизацию правил
