# План реализации Desktop приложения для объединения Excel файлов

## Описание проекта
Desktop приложение на Go для объединения нескольких Excel документов с идентичной структурой столбцов в один файл. Приложение работает по принципу выбора базового файла, где пользователь настраивает правила объединения (выбор листов и строки с заголовками), после чего все остальные файлы объединяются согласно этим правилам.

## Основная концепция работы
1. **Выбор базового файла** - пользователь выбирает один Excel файл как шаблон
2. **Анализ структуры** - программа читает и отображает все листы из базового файла
3. **Настройка правил** - для каждого листа пользователь указывает номер строки с заголовками
4. **Добавление файлов** - пользователь добавляет остальные Excel файлы для объединения
5. **Объединение** - все данные склеиваются в один файл с общими заголовками
6. **Сохранение** - результат сохраняется в новый Excel файл

**Важно:** Предполагается, что все файлы имеют одинаковую структуру столбцов, поэтому валидация соответствия не требуется.

## Технологический стек

### Основные технологии
- **Go 1.21+** - язык программирования
- **Fyne v2.4+** - GUI фреймворк для создания современного кросс-платформенного интерфейса
- **excelize v2.8+** - библиотека для работы с Excel файлами (.xlsx)

### Дополнительные библиотеки
- **encoding/json** - работа с конфигурационными файлами
- **log/slog** - структурированное логирование (Go 1.21+)

### Преимущества выбранного стека
- ✅ Один исполняемый файл без зависимостей (~30-50 MB)
- ✅ Высокая производительность (в 5-10 раз быстрее Python)
- ✅ Простая кросс-компиляция для Windows/macOS/Linux
- ✅ Современный Material Design интерфейс через Fyne
- ✅ Низкое потребление памяти
- ✅ Быстрая разработка с простым синтаксисом Go

## Этапы реализации

### Этап 1: Проектирование архитектуры (1 день)
- [x] Определить основные пакеты и структуры
- [x] Спроектировать структуру проекта
- [x] Определить форматы конфигурационных файлов (JSON)
- [x] Создать документацию

### Этап 2: Разработка ядра (2-3 дня)
- [ ] Пакет excel (работа с Excel)
  - Чтение списка листов
  - Чтение данных с указанной строки заголовков
  - Сохранение результата в .xlsx
  - Обработка ошибок
- [ ] Пакет core (бизнес-логика)
  - BaseAnalyzer для анализа базового файла
  - Merger для объединения данных
  - SheetConfig структура
- [ ] Пакет config (управление конфигурацией)
  - Сохранение/загрузка профилей в JSON
  - Валидация конфигурации

### Этап 3: Разработка GUI (3-4 дня)
- [ ] Главное окно приложения (Fyne)
- [ ] Tab 1: Выбор и анализ базового файла
  - Кнопка выбора файла
  - widget.Tree для отображения листов с чекбоксами
  - widget.Entry для номера строки заголовков
  - widget.Table для предпросмотра заголовков
  - Кнопки сохранения/загрузки профиля
- [ ] Tab 2: Добавление файлов для объединения
  - widget.List для списка файлов
  - Drag & Drop функционал
  - Кнопки управления списком
- [ ] Tab 3: Объединение и сохранение
  - widget.ProgressBar для прогресса
  - widget.Table для предпросмотра результата
  - widget.Label для статистики
  - Кнопки "Объединить" и "Сохранить как..."

### Этап 4: Дополнительный функционал (1-2 дня)
- [ ] Сохранение/загрузка профилей настроек (JSON)
- [ ] Экспорт статистики объединения
- [ ] Темная/светлая тема (встроено в Fyne)
- [ ] Опция пропуска пустых строк
- [ ] Обработка больших файлов через goroutines

### Этап 5: Тестирование и отладка (1-2 дня)
- [ ] Unit-тесты для пакетов core и excel
- [ ] Интеграционные тесты
- [ ] Бенчмарки производительности
- [ ] Тестирование на различных типах Excel файлов
- [ ] Тестирование с разным количеством листов
- [ ] Обработка edge cases и ошибок

### Этап 6: Упаковка и распространение (1 день)
- [ ] Сборка для Windows (fyne package)
- [ ] Сборка для macOS (.app)
- [ ] Сборка для Linux
- [ ] Написание документации пользователя
- [ ] README с инструкциями

## Структура проекта

```
Merge-excel/
├── cmd/
│   └── excel-merger/
│       └── main.go            # Точка входа приложения
├── internal/
│   ├── gui/                   # Интерфейс (Fyne)
│   │   ├── app.go            # Главное окно
│   │   ├── base_file_tab.go  # Tab 1: Базовый файл
│   │   ├── file_list_tab.go  # Tab 2: Список файлов
│   │   └── merge_tab.go      # Tab 3: Объединение
│   ├── core/                  # Бизнес-логика
│   │   ├── analyzer.go       # Анализ базового файла
│   │   ├── merger.go         # Логика объединения
│   │   └── config.go         # Структуры конфигурации
│   ├── excel/                 # Работа с Excel
│   │   ├── reader.go         # Чтение файлов (excelize)
│   │   └── writer.go         # Сохранение результата
│   ├── config/                # Управление профилями
│   │   └── manager.go        # Сохранение/загрузка JSON
│   └── logger/                # Логирование
│       └── logger.go         # Настройка slog
├── pkg/                       # Публичные пакеты (если нужны)
├── testdata/                  # Тестовые Excel файлы
├── configs/                   # Сохраненные профили
├── docs/                      # Документация
│   ├── project-plan.md
│   ├── tech-stack.md
│   ├── architecture.md
│   ├── merge-algorithm.md
│   └── user-guide.md
├── assets/                    # Ресурсы
│   └── icon.png
├── go.mod
├── go.sum
├── Makefile                   # Команды сборки
└── README.md
```

## Основные функции приложения

### 1. Работа с базовым файлом
- **Выбор базового файла** - пользователь указывает шаблонный Excel файл
- **Анализ структуры** - автоматическое извлечение всех листов
- **Настройка правил для каждого листа:**
  - Выбор листов для обработки (чекбоксы)
  - Указание номера строки с заголовками (по умолчанию - 1)
  - Предпросмотр заголовков после выбора строки
  - Возможность исключить отдельные листы из обработки

### 2. Добавление файлов для объединения
- Drag & Drop интерфейс для добавления файлов
- Поддержка множественного выбора файлов
- Отображение списка файлов с возможностью удаления
- Изменение порядка обработки (если важно)

### 3. Процесс объединения
- **Применение правил** - использование настроек из базового файла для всех файлов
- **Склеивание данных:**
  - Берется строка заголовков из базового файла (единожды)
  - Данные из всех файлов (включая базовый) добавляются построчно
  - Обработка каждого выбранного листа отдельно
  - Результат: один лист = объединенные данные со всех файлов
- **Индикация прогресса** - отображение текущего статуса обработки

### 4. Предпросмотр и сохранение
- Предпросмотр первых 50-100 строк результата
- Статистика: количество обработанных файлов, строк, листов
- Сохранение в .xlsx формат
- Возможность выбора пути сохранения

### 5. Управление профилями
- Сохранение конфигурации правил (какие листы, какие строки заголовков)
- Загрузка ранее сохраненных профилей для повторного использования
- Формат: JSON файл с настройками

## Пример рабочего процесса

```
Шаг 1: Выбор базового файла
├─ Файл: sales_2024_q1.xlsx
├─ Листы: 
│  ☑ Продажи (строка заголовков: 1)
│  ☑ Возвраты (строка заголовков: 2)
│  ☐ Справка (исключен)
└─ [Сохранить правила] [Далее]

Шаг 2: Добавление файлов
├─ sales_2024_q2.xlsx
├─ sales_2024_q3.xlsx
├─ sales_2024_q4.xlsx
└─ [Объединить]

Шаг 3: Результат
├─ Лист "Продажи": 
│  - Заголовок (1 раз из базового файла)
│  - Данные из 4 файлов (все строки после заголовка)
├─ Лист "Возвраты":
│  - Заголовок (1 раз, строка 2 из базового файла)
│  - Данные из 4 файлов (все строки после строки 2)
└─ [Сохранить как...]
```

## Риски и их минимизация

| Риск | Вероятность | Митигация |
|------|-------------|-----------|
| Проблемы с большими файлами | Средняя | Использовать чанки, показывать прогресс |
| Разная структура листов в файлах | Низкая | Предупреждение пользователя, что структура должна быть идентичной |
| Отсутствие листа в некоторых файлах | Средняя | Пропускать файлы без предупреждения или уведомлять пользователя |
| Неправильный номер строки заголовков | Средняя | Предпросмотр заголовков перед объединением |
| Конфликты зависимостей | Низкая | Использовать виртуальное окружение |
| Проблемы упаковки под macOS | Средняя | Тестирование на разных ОС |

## Следующие шаги
1. ✅ Согласовать технический стек (Go + Fyne + excelize)
2. ✅ Создать документацию архитектуры
3. Инициализировать Go проект (`go mod init`)
4. Создать базовую структуру проекта
5. Начать с разработки ядра (пакеты excel и core)
6. Параллельно проектировать GUI
7. Итеративная разработка с регулярным тестированием

## Общее время разработки
**8-12 дней** (против 10-14 дней на Python)

Преимущества Go:
- Более простая архитектура без "магии" фреймворка
- Быстрая компиляция и отладка
- Меньше времени на упаковку (один файл vs PyInstaller)
- Встроенное тестирование
